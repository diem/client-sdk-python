<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>diem.testing.cli API documentation</title>
<meta name="description" content="This module provides command-line interface for starting mini-wallet application and running test suites." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>diem.testing.cli</code></h1>
</header>
<section id="section-intro">
<p>This module provides command-line interface for starting mini-wallet application and running test suites.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># Copyright (c) The Diem Core Contributors
# SPDX-License-Identifier: Apache-2.0

&#34;&#34;&#34;This module provides command-line interface for starting mini-wallet application and running test suites.
&#34;&#34;&#34;

from diem import testnet
from diem.testing import LocalAccount
from diem.testing.miniwallet import AppConfig, ServerConfig
from diem.testing.suites import envs
from typing import Optional, TextIO
import logging, click, functools, pytest, os, sys, re, json

log_format: str = &#34;%(name)s [%(asctime)s] %(levelname)s: %(message)s&#34;
click.option = functools.partial(click.option, show_default=True)  # pyre-ignore


def set_env(name: str, is_io: bool = False):  # pyre-ignore
    def callback(_c, _p, val):  # pyre-ignore
        if val:
            os.environ[name] = val.read() if is_io else str(val)
        return val

    return callback


@click.group()
def main() -&gt; None:
    pass


@click.command()
@click.option(&#34;--name&#34;, &#34;-n&#34;, default=&#34;mini-wallet&#34;, help=&#34;Application name.&#34;)
@click.option(&#34;--host&#34;, &#34;-h&#34;, default=&#34;localhost&#34;, help=&#34;Start server host.&#34;)
@click.option(&#34;--port&#34;, &#34;-p&#34;, default=8888, help=&#34;Start server port.&#34;)
@click.option(&#34;--jsonrpc&#34;, &#34;-j&#34;, default=testnet.JSON_RPC_URL, help=&#34;Diem fullnode JSON-RPC URL.&#34;)
@click.option(&#34;--faucet&#34;, &#34;-f&#34;, default=testnet.FAUCET_URL, help=&#34;Testnet faucet URL.&#34;)
@click.option(&#34;--enable-debug-api&#34;, &#34;-o&#34;, default=True, help=&#34;Enable debug API.&#34;, type=bool, is_flag=True)
@click.option(
    &#34;--logfile&#34;, &#34;-l&#34;, default=None, type=click.Path(), help=&#34;Log to a file instead of printing into console.&#34;
)
@click.option(
    &#34;--import-diem-account-config-file&#34;,
    &#34;-i&#34;,
    default=None,
    help=&#34;Import the diem account config from a file. The config file content should be JSON generated from command `gen-diem-account-config`.&#34;,
    type=click.File(),
)
def start_server(
    name: str,
    host: str,
    port: int,
    jsonrpc: str,
    faucet: str,
    enable_debug_api: bool,
    import_diem_account_config_file: Optional[TextIO],
    logfile: Optional[str],
) -&gt; None:
    logging.basicConfig(level=logging.INFO, format=log_format, filename=logfile)
    configure_testnet(jsonrpc, faucet)

    conf = AppConfig(name=name, server_conf=ServerConfig(host=host, port=port), enable_debug_api=enable_debug_api)
    if import_diem_account_config_file:
        conf.account_config = json.load(import_diem_account_config_file)

    print(&#34;Server Config: %s&#34; % conf)

    client = testnet.create_client()
    print(&#34;Diem chain id: %s&#34; % client.get_metadata().chain_id)

    conf.start(client).join()


@click.command()
@click.option(
    &#34;--target&#34;,
    &#34;-t&#34;,
    default=&#34;http://localhost:8888&#34;,
    callback=set_env(envs.TARGET_URL),
    help=&#34;Target mini-wallet application URL.&#34;,
)
@click.option(
    &#34;--stub-bind-host&#34;,
    &#34;-h&#34;,
    default=&#34;localhost&#34;,
    callback=set_env(envs.DMW_STUB_BIND_HOST),
    help=&#34;The host the miniwallet stub server will bind to&#34;,
)
@click.option(
    &#34;--stub-bind-port&#34;,
    &#34;-p&#34;,
    default=None,
    callback=set_env(envs.DMW_STUB_BIND_PORT),
    help=&#34;The port the miniwallet stub server will bind to. Random if empty.&#34;,
    type=int,
)
@click.option(
    &#34;--stub-diem-account-base-url&#34;,
    &#34;-u&#34;,
    default=None,
    callback=set_env(envs.DMW_STUB_DIEM_ACCOUNT_BASE_URL),
    help=&#34;The address that will be used for offchain callbacks. Defaults to http://localhost:{random_port}&#34;,
)
@click.option(&#34;--jsonrpc&#34;, &#34;-j&#34;, default=testnet.JSON_RPC_URL, help=&#34;Diem fullnode JSON-RPC URL.&#34;)
@click.option(&#34;--faucet&#34;, &#34;-f&#34;, default=testnet.FAUCET_URL, help=&#34;Testnet faucet URL.&#34;)
@click.option(
    &#34;--pytest-args&#34;,
    default=&#34;&#34;,
    help=&#34;Additional pytest arguments, split by empty space, e.g. `--pytest-args &#39;-v -s&#39;`.&#34;,
    show_default=False,
)
@click.option(
    &#34;--test-debug-api&#34;,
    &#34;-d&#34;,
    default=False,
    is_flag=True,
    callback=set_env(envs.TEST_DEBUG_API),
    help=&#34;Run tests for debug APIs.&#34;,
    type=bool,
)
@click.option(
    &#34;--logfile&#34;, &#34;-l&#34;, default=None, help=&#34;Log to a file instead of printing into console.&#34;, type=click.Path()
)
@click.option(&#34;--verbose&#34;, &#34;-v&#34;, default=False, help=&#34;Enable verbose log output.&#34;, type=bool, is_flag=True)
@click.option(  # pyre-ignore
    &#34;--import-stub-diem-account-config-file&#34;,
    &#34;-i&#34;,
    default=None,
    callback=set_env(envs.DMW_STUB_DIEM_ACCOUNT_CONFIG, is_io=True),
    help=&#34;Import the diem account config from a file for miniwallet stub server. The config file content should be JSON generated from command `gen-diem-account-config`.&#34;,
    type=click.File(),
)
def test(
    target: str,
    stub_bind_host: Optional[str],
    stub_bind_port: Optional[int],
    stub_diem_account_base_url: Optional[str],
    jsonrpc: str,
    faucet: str,
    pytest_args: str,
    test_debug_api: bool,
    logfile: Optional[str],
    verbose: bool,
    import_stub_diem_account_config_file: Optional[TextIO],
) -&gt; None:
    configure_testnet(jsonrpc, faucet)

    # If stub_bind_host is provided, then stub_diem_account_base_url must be as well or the test won&#39;t work
    if stub_bind_host is not None and stub_bind_host != &#34;localhost&#34; and not stub_diem_account_base_url:
        raise click.ClickException(&#34;--stub-diem-account-base-url is required when passing in a custom --stub-bind-host&#34;)

    args = [arg for arg in re.compile(&#34;\\s+&#34;).split(pytest_args) if arg]
    args = [&#34;--pyargs&#34;, &#34;diem.testing.suites&#34;] + args
    if verbose:
        args.append(&#34;--log-level=INFO&#34;)
        args.append(&#34;-s&#34;)
        args.append(&#34;-v&#34;)
    if logfile:
        args.append(&#34;--log-file=%s&#34; % logfile)

    code = pytest.main(args)
    sys.stdout.flush()
    raise SystemExit(code)


@click.command()
def gen_diem_account_config() -&gt; None:
    print(LocalAccount().to_json())


def configure_testnet(jsonrpc: str, faucet: str) -&gt; None:
    testnet.JSON_RPC_URL = jsonrpc
    testnet.FAUCET_URL = faucet
    print(&#34;Diem JSON-RPC URL: %s&#34; % testnet.JSON_RPC_URL)
    print(&#34;Diem Testnet Faucet URL: %s&#34; % testnet.FAUCET_URL)


main.add_command(start_server)
main.add_command(test)
main.add_command(gen_diem_account_config)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="diem.testing.cli.configure_testnet"><code class="name flex">
<span>def <span class="ident">configure_testnet</span></span>(<span>jsonrpc: str, faucet: str) ‑> NoneType</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def configure_testnet(jsonrpc: str, faucet: str) -&gt; None:
    testnet.JSON_RPC_URL = jsonrpc
    testnet.FAUCET_URL = faucet
    print(&#34;Diem JSON-RPC URL: %s&#34; % testnet.JSON_RPC_URL)
    print(&#34;Diem Testnet Faucet URL: %s&#34; % testnet.FAUCET_URL)</code></pre>
</details>
</dd>
<dt id="diem.testing.cli.set_env"><code class="name flex">
<span>def <span class="ident">set_env</span></span>(<span>name: str, is_io: bool = False)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def set_env(name: str, is_io: bool = False):  # pyre-ignore
    def callback(_c, _p, val):  # pyre-ignore
        if val:
            os.environ[name] = val.read() if is_io else str(val)
        return val

    return callback</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="diem.testing" href="index.html">diem.testing</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="diem.testing.cli.configure_testnet" href="#diem.testing.cli.configure_testnet">configure_testnet</a></code></li>
<li><code><a title="diem.testing.cli.set_env" href="#diem.testing.cli.set_env">set_env</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>