<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>diem.testing.miniwallet.client API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>diem.testing.miniwallet.client</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># Copyright (c) The Diem Core Contributors
# SPDX-License-Identifier: Apache-2.0

from dataclasses import dataclass, field, replace, asdict
from requests.adapters import HTTPAdapter
from requests.packages.urllib3.util.retry import Retry
from typing import List, Optional, Any, Dict, Callable
from .app import PaymentUri, KycSample, Event, Payment
from .app.store import _match
from ... import offchain, jsonrpc
import requests, logging, random, string, json, time


@dataclass
class RestClient:
    name: str
    server_url: str
    session: requests.Session = field(default_factory=requests.Session)
    logger: logging.Logger = field(init=False)

    def __post_init__(self) -&gt; None:
        self.logger = logging.getLogger(self.name)

    def with_retry(self, retry: Retry = Retry(total=5, connect=5, backoff_factor=0.01)) -&gt; &#34;RestClient&#34;:
        self.session.mount(self.server_url, HTTPAdapter(max_retries=retry))
        return self

    def create_account(
        self, balances: Optional[Dict[str, int]] = None, kyc_data: Optional[str] = None
    ) -&gt; &#34;AccountResource&#34;:
        account = self.create(&#34;/accounts&#34;, kyc_data=kyc_data, balances=balances)
        return AccountResource(client=self, id=account[&#34;id&#34;], kyc_data=account.get(&#34;kyc_data&#34;, None))

    def new_soft_match_kyc_data(self) -&gt; str:
        return self.new_kyc_data(sample=&#34;soft_match&#34;)

    def new_reject_kyc_data(self) -&gt; str:
        return self.new_kyc_data(sample=&#34;reject&#34;)

    def new_soft_reject_kyc_data(self) -&gt; str:
        return self.new_kyc_data(sample=&#34;soft_reject&#34;)

    def new_valid_kyc_data(self) -&gt; str:
        return self.new_kyc_data(sample=&#34;minimum&#34;)

    def new_kyc_data(self, name: Optional[str] = None, sample: str = &#34;minimum&#34;) -&gt; str:
        obj = offchain.from_json(getattr(self.kyc_sample(), sample), offchain.KycDataObject)
        if not name:
            name = &#34;&#34;.join(random.choices(string.ascii_uppercase + string.digits, k=6))
        return offchain.to_json(replace(obj, legal_entity_name=name))

    def kyc_sample(self) -&gt; KycSample:
        return KycSample(**self.send(&#34;GET&#34;, &#34;/kyc_sample&#34;).json())

    def create(self, path: str, **kwargs: Any) -&gt; Dict[str, Any]:
        return self.send(&#34;POST&#34;, path, json.dumps(kwargs) if kwargs else None).json()

    def get(self, path: str) -&gt; Dict[str, Any]:
        return self.send(&#34;GET&#34;, path).json()

    def send(self, method: str, path: str, data: Optional[str] = None) -&gt; requests.Response:
        url = &#34;%s/%s&#34; % (self.server_url.rstrip(&#34;/&#34;), path.lstrip(&#34;/&#34;))
        self.logger.info(&#34;%s %s: %s&#34; % (method, path, data))
        resp = self.session.request(
            method=method,
            url=url.lower(),
            data=data,
            headers={&#34;Content-Type&#34;: &#34;application/json&#34;, &#34;User-Agent&#34;: jsonrpc.client.USER_AGENT_HTTP_HEADER},
        )
        self.logger.info(&#34;response status code: %s&#34; % resp.status_code)
        self.logger.info(&#34;response body: %s&#34; % resp.text)
        resp.raise_for_status()
        return resp


@dataclass
class AccountResource:

    client: RestClient
    id: str
    kyc_data: Optional[str] = field(default=None)

    def balance(self, currency: str) -&gt; int:
        return self._balances().get(currency, 0)

    def send_payment(self, currency: str, amount: int, payee: str) -&gt; Payment:
        p = self.client.create(self._resources(&#34;payment&#34;), payee=payee, currency=currency, amount=amount)
        return Payment(**p)

    def generate_payment_uri(self, currency: Optional[str] = None, amount: Optional[int] = None) -&gt; PaymentUri:
        return PaymentUri(**self.client.create(self._resources(&#34;payment_uri&#34;), currency=currency, amount=amount))

    def events(self, start: int = 0) -&gt; List[Event]:
        ret = self.client.send(&#34;GET&#34;, self._resources(&#34;event&#34;)).json()
        return [Event(**obj) for obj in ret[start:]]

    def wait_for_balance(self, currency: str, amount: int) -&gt; None:
        def fn() -&gt; None:
            assert self.balance(currency) == amount, &#34;currency: %s&#34; % currency

        self.wait_for(fn)

    def wait_for_event(self, event_type: str, start_index: int = 0, **kwargs: Any) -&gt; None:
        def fn() -&gt; None:
            events = [e for e in self.events(start_index) if e.type == event_type]
            for e in events:
                if _match(json.loads(e.data), **kwargs):
                    return
            assert False, &#34;could not find %s event with %s&#34; % (event_type, kwargs)

        self.wait_for(fn)

    def wait_for(self, fn: Callable[[], None], max_tries: int = 120, delay: float = 0.1) -&gt; None:
        tries = 0
        while True:
            tries += 1
            try:
                return fn()
            except AssertionError as e:
                if tries &gt;= max_tries:
                    raise TimeoutError(&#34;%s, events: \n%s&#34; % (e, self.dump_events())) from e
                time.sleep(delay)

    def log_events(self) -&gt; None:
        events = self.dump_events()
        if events:
            self.client.logger.info(&#34;account(%s) events: %s&#34;, self.id, events)

    def dump_events(self) -&gt; str:
        try:
            return json.dumps(list(map(self.event_asdict, self.events())), indent=2)
        except requests.HTTPError:
            return &#34;&#34;

    def event_asdict(self, event: Event) -&gt; Dict[str, Any]:
        ret = asdict(event)
        try:
            ret[&#34;data&#34;] = json.loads(event.data)
            if ret[&#34;data&#34;].get(&#34;kyc_data&#34;):
                ret[&#34;data&#34;][&#34;kyc_data&#34;] = json.loads(ret[&#34;data&#34;][&#34;kyc_data&#34;])
        except json.decoder.JSONDecodeError:
            pass
        return ret

    def info(self, *args: Any, **kwargs: Any) -&gt; None:
        self.client.logger.info(*args, **kwargs)

    def _balances(self) -&gt; Dict[str, int]:
        &#34;&#34;&#34;returns account balances object

        should always prefer to use func `balance(currency) -&gt; int`, which returns zero
        when currency not exist in the response.
        &#34;&#34;&#34;

        return self.client.get(self._resources(&#34;balance&#34;))

    def _resources(self, resource: str) -&gt; str:
        return &#34;/accounts/%s/%ss&#34; % (self.id, resource)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="diem.testing.miniwallet.client.AccountResource"><code class="flex name class">
<span>class <span class="ident">AccountResource</span></span>
<span>(</span><span>client: <a title="diem.testing.miniwallet.client.RestClient" href="#diem.testing.miniwallet.client.RestClient">RestClient</a>, id: str, kyc_data: Optional[str] = None)</span>
</code></dt>
<dd>
<div class="desc"><p>AccountResource(client: diem.testing.miniwallet.client.RestClient, id: str, kyc_data: Optional[str] = None)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass
class AccountResource:

    client: RestClient
    id: str
    kyc_data: Optional[str] = field(default=None)

    def balance(self, currency: str) -&gt; int:
        return self._balances().get(currency, 0)

    def send_payment(self, currency: str, amount: int, payee: str) -&gt; Payment:
        p = self.client.create(self._resources(&#34;payment&#34;), payee=payee, currency=currency, amount=amount)
        return Payment(**p)

    def generate_payment_uri(self, currency: Optional[str] = None, amount: Optional[int] = None) -&gt; PaymentUri:
        return PaymentUri(**self.client.create(self._resources(&#34;payment_uri&#34;), currency=currency, amount=amount))

    def events(self, start: int = 0) -&gt; List[Event]:
        ret = self.client.send(&#34;GET&#34;, self._resources(&#34;event&#34;)).json()
        return [Event(**obj) for obj in ret[start:]]

    def wait_for_balance(self, currency: str, amount: int) -&gt; None:
        def fn() -&gt; None:
            assert self.balance(currency) == amount, &#34;currency: %s&#34; % currency

        self.wait_for(fn)

    def wait_for_event(self, event_type: str, start_index: int = 0, **kwargs: Any) -&gt; None:
        def fn() -&gt; None:
            events = [e for e in self.events(start_index) if e.type == event_type]
            for e in events:
                if _match(json.loads(e.data), **kwargs):
                    return
            assert False, &#34;could not find %s event with %s&#34; % (event_type, kwargs)

        self.wait_for(fn)

    def wait_for(self, fn: Callable[[], None], max_tries: int = 120, delay: float = 0.1) -&gt; None:
        tries = 0
        while True:
            tries += 1
            try:
                return fn()
            except AssertionError as e:
                if tries &gt;= max_tries:
                    raise TimeoutError(&#34;%s, events: \n%s&#34; % (e, self.dump_events())) from e
                time.sleep(delay)

    def log_events(self) -&gt; None:
        events = self.dump_events()
        if events:
            self.client.logger.info(&#34;account(%s) events: %s&#34;, self.id, events)

    def dump_events(self) -&gt; str:
        try:
            return json.dumps(list(map(self.event_asdict, self.events())), indent=2)
        except requests.HTTPError:
            return &#34;&#34;

    def event_asdict(self, event: Event) -&gt; Dict[str, Any]:
        ret = asdict(event)
        try:
            ret[&#34;data&#34;] = json.loads(event.data)
            if ret[&#34;data&#34;].get(&#34;kyc_data&#34;):
                ret[&#34;data&#34;][&#34;kyc_data&#34;] = json.loads(ret[&#34;data&#34;][&#34;kyc_data&#34;])
        except json.decoder.JSONDecodeError:
            pass
        return ret

    def info(self, *args: Any, **kwargs: Any) -&gt; None:
        self.client.logger.info(*args, **kwargs)

    def _balances(self) -&gt; Dict[str, int]:
        &#34;&#34;&#34;returns account balances object

        should always prefer to use func `balance(currency) -&gt; int`, which returns zero
        when currency not exist in the response.
        &#34;&#34;&#34;

        return self.client.get(self._resources(&#34;balance&#34;))

    def _resources(self, resource: str) -&gt; str:
        return &#34;/accounts/%s/%ss&#34; % (self.id, resource)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="diem.testing.miniwallet.client.AccountResource.client"><code class="name">var <span class="ident">client</span> : <a title="diem.testing.miniwallet.client.RestClient" href="#diem.testing.miniwallet.client.RestClient">RestClient</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="diem.testing.miniwallet.client.AccountResource.id"><code class="name">var <span class="ident">id</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="diem.testing.miniwallet.client.AccountResource.kyc_data"><code class="name">var <span class="ident">kyc_data</span> : Optional[str]</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="diem.testing.miniwallet.client.AccountResource.balance"><code class="name flex">
<span>def <span class="ident">balance</span></span>(<span>self, currency: str) ‑> int</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def balance(self, currency: str) -&gt; int:
    return self._balances().get(currency, 0)</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.AccountResource.dump_events"><code class="name flex">
<span>def <span class="ident">dump_events</span></span>(<span>self) ‑> str</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def dump_events(self) -&gt; str:
    try:
        return json.dumps(list(map(self.event_asdict, self.events())), indent=2)
    except requests.HTTPError:
        return &#34;&#34;</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.AccountResource.event_asdict"><code class="name flex">
<span>def <span class="ident">event_asdict</span></span>(<span>self, event: <a title="diem.testing.miniwallet.app.models.Event" href="app/models.html#diem.testing.miniwallet.app.models.Event">Event</a>) ‑> Dict[str, Any]</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def event_asdict(self, event: Event) -&gt; Dict[str, Any]:
    ret = asdict(event)
    try:
        ret[&#34;data&#34;] = json.loads(event.data)
        if ret[&#34;data&#34;].get(&#34;kyc_data&#34;):
            ret[&#34;data&#34;][&#34;kyc_data&#34;] = json.loads(ret[&#34;data&#34;][&#34;kyc_data&#34;])
    except json.decoder.JSONDecodeError:
        pass
    return ret</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.AccountResource.events"><code class="name flex">
<span>def <span class="ident">events</span></span>(<span>self, start: int = 0) ‑> List[<a title="diem.testing.miniwallet.app.models.Event" href="app/models.html#diem.testing.miniwallet.app.models.Event">Event</a>]</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def events(self, start: int = 0) -&gt; List[Event]:
    ret = self.client.send(&#34;GET&#34;, self._resources(&#34;event&#34;)).json()
    return [Event(**obj) for obj in ret[start:]]</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.AccountResource.generate_payment_uri"><code class="name flex">
<span>def <span class="ident">generate_payment_uri</span></span>(<span>self, currency: Optional[str] = None, amount: Optional[int] = None) ‑> <a title="diem.testing.miniwallet.app.models.PaymentUri" href="app/models.html#diem.testing.miniwallet.app.models.PaymentUri">PaymentUri</a></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def generate_payment_uri(self, currency: Optional[str] = None, amount: Optional[int] = None) -&gt; PaymentUri:
    return PaymentUri(**self.client.create(self._resources(&#34;payment_uri&#34;), currency=currency, amount=amount))</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.AccountResource.info"><code class="name flex">
<span>def <span class="ident">info</span></span>(<span>self, *args: Any, **kwargs: Any) ‑> NoneType</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def info(self, *args: Any, **kwargs: Any) -&gt; None:
    self.client.logger.info(*args, **kwargs)</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.AccountResource.log_events"><code class="name flex">
<span>def <span class="ident">log_events</span></span>(<span>self) ‑> NoneType</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def log_events(self) -&gt; None:
    events = self.dump_events()
    if events:
        self.client.logger.info(&#34;account(%s) events: %s&#34;, self.id, events)</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.AccountResource.send_payment"><code class="name flex">
<span>def <span class="ident">send_payment</span></span>(<span>self, currency: str, amount: int, payee: str) ‑> <a title="diem.testing.miniwallet.app.models.Payment" href="app/models.html#diem.testing.miniwallet.app.models.Payment">Payment</a></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def send_payment(self, currency: str, amount: int, payee: str) -&gt; Payment:
    p = self.client.create(self._resources(&#34;payment&#34;), payee=payee, currency=currency, amount=amount)
    return Payment(**p)</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.AccountResource.wait_for"><code class="name flex">
<span>def <span class="ident">wait_for</span></span>(<span>self, fn: Callable[[], NoneType], max_tries: int = 120, delay: float = 0.1) ‑> NoneType</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def wait_for(self, fn: Callable[[], None], max_tries: int = 120, delay: float = 0.1) -&gt; None:
    tries = 0
    while True:
        tries += 1
        try:
            return fn()
        except AssertionError as e:
            if tries &gt;= max_tries:
                raise TimeoutError(&#34;%s, events: \n%s&#34; % (e, self.dump_events())) from e
            time.sleep(delay)</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.AccountResource.wait_for_balance"><code class="name flex">
<span>def <span class="ident">wait_for_balance</span></span>(<span>self, currency: str, amount: int) ‑> NoneType</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def wait_for_balance(self, currency: str, amount: int) -&gt; None:
    def fn() -&gt; None:
        assert self.balance(currency) == amount, &#34;currency: %s&#34; % currency

    self.wait_for(fn)</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.AccountResource.wait_for_event"><code class="name flex">
<span>def <span class="ident">wait_for_event</span></span>(<span>self, event_type: str, start_index: int = 0, **kwargs: Any) ‑> NoneType</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def wait_for_event(self, event_type: str, start_index: int = 0, **kwargs: Any) -&gt; None:
    def fn() -&gt; None:
        events = [e for e in self.events(start_index) if e.type == event_type]
        for e in events:
            if _match(json.loads(e.data), **kwargs):
                return
        assert False, &#34;could not find %s event with %s&#34; % (event_type, kwargs)

    self.wait_for(fn)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient"><code class="flex name class">
<span>class <span class="ident">RestClient</span></span>
<span>(</span><span>name: str, server_url: str, session: requests.sessions.Session = &lt;factory&gt;)</span>
</code></dt>
<dd>
<div class="desc"><p>RestClient(name: str, server_url: str, session: requests.sessions.Session = <factory>)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass
class RestClient:
    name: str
    server_url: str
    session: requests.Session = field(default_factory=requests.Session)
    logger: logging.Logger = field(init=False)

    def __post_init__(self) -&gt; None:
        self.logger = logging.getLogger(self.name)

    def with_retry(self, retry: Retry = Retry(total=5, connect=5, backoff_factor=0.01)) -&gt; &#34;RestClient&#34;:
        self.session.mount(self.server_url, HTTPAdapter(max_retries=retry))
        return self

    def create_account(
        self, balances: Optional[Dict[str, int]] = None, kyc_data: Optional[str] = None
    ) -&gt; &#34;AccountResource&#34;:
        account = self.create(&#34;/accounts&#34;, kyc_data=kyc_data, balances=balances)
        return AccountResource(client=self, id=account[&#34;id&#34;], kyc_data=account.get(&#34;kyc_data&#34;, None))

    def new_soft_match_kyc_data(self) -&gt; str:
        return self.new_kyc_data(sample=&#34;soft_match&#34;)

    def new_reject_kyc_data(self) -&gt; str:
        return self.new_kyc_data(sample=&#34;reject&#34;)

    def new_soft_reject_kyc_data(self) -&gt; str:
        return self.new_kyc_data(sample=&#34;soft_reject&#34;)

    def new_valid_kyc_data(self) -&gt; str:
        return self.new_kyc_data(sample=&#34;minimum&#34;)

    def new_kyc_data(self, name: Optional[str] = None, sample: str = &#34;minimum&#34;) -&gt; str:
        obj = offchain.from_json(getattr(self.kyc_sample(), sample), offchain.KycDataObject)
        if not name:
            name = &#34;&#34;.join(random.choices(string.ascii_uppercase + string.digits, k=6))
        return offchain.to_json(replace(obj, legal_entity_name=name))

    def kyc_sample(self) -&gt; KycSample:
        return KycSample(**self.send(&#34;GET&#34;, &#34;/kyc_sample&#34;).json())

    def create(self, path: str, **kwargs: Any) -&gt; Dict[str, Any]:
        return self.send(&#34;POST&#34;, path, json.dumps(kwargs) if kwargs else None).json()

    def get(self, path: str) -&gt; Dict[str, Any]:
        return self.send(&#34;GET&#34;, path).json()

    def send(self, method: str, path: str, data: Optional[str] = None) -&gt; requests.Response:
        url = &#34;%s/%s&#34; % (self.server_url.rstrip(&#34;/&#34;), path.lstrip(&#34;/&#34;))
        self.logger.info(&#34;%s %s: %s&#34; % (method, path, data))
        resp = self.session.request(
            method=method,
            url=url.lower(),
            data=data,
            headers={&#34;Content-Type&#34;: &#34;application/json&#34;, &#34;User-Agent&#34;: jsonrpc.client.USER_AGENT_HTTP_HEADER},
        )
        self.logger.info(&#34;response status code: %s&#34; % resp.status_code)
        self.logger.info(&#34;response body: %s&#34; % resp.text)
        resp.raise_for_status()
        return resp</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="diem.testing.miniwallet.client.RestClient.logger"><code class="name">var <span class="ident">logger</span> : logging.Logger</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient.name"><code class="name">var <span class="ident">name</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient.server_url"><code class="name">var <span class="ident">server_url</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient.session"><code class="name">var <span class="ident">session</span> : requests.sessions.Session</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="diem.testing.miniwallet.client.RestClient.create"><code class="name flex">
<span>def <span class="ident">create</span></span>(<span>self, path: str, **kwargs: Any) ‑> Dict[str, Any]</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create(self, path: str, **kwargs: Any) -&gt; Dict[str, Any]:
    return self.send(&#34;POST&#34;, path, json.dumps(kwargs) if kwargs else None).json()</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient.create_account"><code class="name flex">
<span>def <span class="ident">create_account</span></span>(<span>self, balances: Optional[Dict[str, int]] = None, kyc_data: Optional[str] = None) ‑> <a title="diem.testing.miniwallet.client.AccountResource" href="#diem.testing.miniwallet.client.AccountResource">AccountResource</a></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_account(
    self, balances: Optional[Dict[str, int]] = None, kyc_data: Optional[str] = None
) -&gt; &#34;AccountResource&#34;:
    account = self.create(&#34;/accounts&#34;, kyc_data=kyc_data, balances=balances)
    return AccountResource(client=self, id=account[&#34;id&#34;], kyc_data=account.get(&#34;kyc_data&#34;, None))</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient.get"><code class="name flex">
<span>def <span class="ident">get</span></span>(<span>self, path: str) ‑> Dict[str, Any]</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get(self, path: str) -&gt; Dict[str, Any]:
    return self.send(&#34;GET&#34;, path).json()</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient.kyc_sample"><code class="name flex">
<span>def <span class="ident">kyc_sample</span></span>(<span>self) ‑> <a title="diem.testing.miniwallet.app.models.KycSample" href="app/models.html#diem.testing.miniwallet.app.models.KycSample">KycSample</a></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def kyc_sample(self) -&gt; KycSample:
    return KycSample(**self.send(&#34;GET&#34;, &#34;/kyc_sample&#34;).json())</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient.new_kyc_data"><code class="name flex">
<span>def <span class="ident">new_kyc_data</span></span>(<span>self, name: Optional[str] = None, sample: str = 'minimum') ‑> str</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def new_kyc_data(self, name: Optional[str] = None, sample: str = &#34;minimum&#34;) -&gt; str:
    obj = offchain.from_json(getattr(self.kyc_sample(), sample), offchain.KycDataObject)
    if not name:
        name = &#34;&#34;.join(random.choices(string.ascii_uppercase + string.digits, k=6))
    return offchain.to_json(replace(obj, legal_entity_name=name))</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient.new_reject_kyc_data"><code class="name flex">
<span>def <span class="ident">new_reject_kyc_data</span></span>(<span>self) ‑> str</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def new_reject_kyc_data(self) -&gt; str:
    return self.new_kyc_data(sample=&#34;reject&#34;)</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient.new_soft_match_kyc_data"><code class="name flex">
<span>def <span class="ident">new_soft_match_kyc_data</span></span>(<span>self) ‑> str</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def new_soft_match_kyc_data(self) -&gt; str:
    return self.new_kyc_data(sample=&#34;soft_match&#34;)</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient.new_soft_reject_kyc_data"><code class="name flex">
<span>def <span class="ident">new_soft_reject_kyc_data</span></span>(<span>self) ‑> str</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def new_soft_reject_kyc_data(self) -&gt; str:
    return self.new_kyc_data(sample=&#34;soft_reject&#34;)</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient.new_valid_kyc_data"><code class="name flex">
<span>def <span class="ident">new_valid_kyc_data</span></span>(<span>self) ‑> str</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def new_valid_kyc_data(self) -&gt; str:
    return self.new_kyc_data(sample=&#34;minimum&#34;)</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient.send"><code class="name flex">
<span>def <span class="ident">send</span></span>(<span>self, method: str, path: str, data: Optional[str] = None) ‑> requests.models.Response</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def send(self, method: str, path: str, data: Optional[str] = None) -&gt; requests.Response:
    url = &#34;%s/%s&#34; % (self.server_url.rstrip(&#34;/&#34;), path.lstrip(&#34;/&#34;))
    self.logger.info(&#34;%s %s: %s&#34; % (method, path, data))
    resp = self.session.request(
        method=method,
        url=url.lower(),
        data=data,
        headers={&#34;Content-Type&#34;: &#34;application/json&#34;, &#34;User-Agent&#34;: jsonrpc.client.USER_AGENT_HTTP_HEADER},
    )
    self.logger.info(&#34;response status code: %s&#34; % resp.status_code)
    self.logger.info(&#34;response body: %s&#34; % resp.text)
    resp.raise_for_status()
    return resp</code></pre>
</details>
</dd>
<dt id="diem.testing.miniwallet.client.RestClient.with_retry"><code class="name flex">
<span>def <span class="ident">with_retry</span></span>(<span>self, retry: urllib3.util.retry.Retry = Retry(total=5, connect=5, read=None, redirect=None, status=None)) ‑> <a title="diem.testing.miniwallet.client.RestClient" href="#diem.testing.miniwallet.client.RestClient">RestClient</a></span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def with_retry(self, retry: Retry = Retry(total=5, connect=5, backoff_factor=0.01)) -&gt; &#34;RestClient&#34;:
    self.session.mount(self.server_url, HTTPAdapter(max_retries=retry))
    return self</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="diem.testing.miniwallet" href="index.html">diem.testing.miniwallet</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="diem.testing.miniwallet.client.AccountResource" href="#diem.testing.miniwallet.client.AccountResource">AccountResource</a></code></h4>
<ul class="">
<li><code><a title="diem.testing.miniwallet.client.AccountResource.balance" href="#diem.testing.miniwallet.client.AccountResource.balance">balance</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.AccountResource.client" href="#diem.testing.miniwallet.client.AccountResource.client">client</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.AccountResource.dump_events" href="#diem.testing.miniwallet.client.AccountResource.dump_events">dump_events</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.AccountResource.event_asdict" href="#diem.testing.miniwallet.client.AccountResource.event_asdict">event_asdict</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.AccountResource.events" href="#diem.testing.miniwallet.client.AccountResource.events">events</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.AccountResource.generate_payment_uri" href="#diem.testing.miniwallet.client.AccountResource.generate_payment_uri">generate_payment_uri</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.AccountResource.id" href="#diem.testing.miniwallet.client.AccountResource.id">id</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.AccountResource.info" href="#diem.testing.miniwallet.client.AccountResource.info">info</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.AccountResource.kyc_data" href="#diem.testing.miniwallet.client.AccountResource.kyc_data">kyc_data</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.AccountResource.log_events" href="#diem.testing.miniwallet.client.AccountResource.log_events">log_events</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.AccountResource.send_payment" href="#diem.testing.miniwallet.client.AccountResource.send_payment">send_payment</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.AccountResource.wait_for" href="#diem.testing.miniwallet.client.AccountResource.wait_for">wait_for</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.AccountResource.wait_for_balance" href="#diem.testing.miniwallet.client.AccountResource.wait_for_balance">wait_for_balance</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.AccountResource.wait_for_event" href="#diem.testing.miniwallet.client.AccountResource.wait_for_event">wait_for_event</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="diem.testing.miniwallet.client.RestClient" href="#diem.testing.miniwallet.client.RestClient">RestClient</a></code></h4>
<ul class="">
<li><code><a title="diem.testing.miniwallet.client.RestClient.create" href="#diem.testing.miniwallet.client.RestClient.create">create</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.create_account" href="#diem.testing.miniwallet.client.RestClient.create_account">create_account</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.get" href="#diem.testing.miniwallet.client.RestClient.get">get</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.kyc_sample" href="#diem.testing.miniwallet.client.RestClient.kyc_sample">kyc_sample</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.logger" href="#diem.testing.miniwallet.client.RestClient.logger">logger</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.name" href="#diem.testing.miniwallet.client.RestClient.name">name</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.new_kyc_data" href="#diem.testing.miniwallet.client.RestClient.new_kyc_data">new_kyc_data</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.new_reject_kyc_data" href="#diem.testing.miniwallet.client.RestClient.new_reject_kyc_data">new_reject_kyc_data</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.new_soft_match_kyc_data" href="#diem.testing.miniwallet.client.RestClient.new_soft_match_kyc_data">new_soft_match_kyc_data</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.new_soft_reject_kyc_data" href="#diem.testing.miniwallet.client.RestClient.new_soft_reject_kyc_data">new_soft_reject_kyc_data</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.new_valid_kyc_data" href="#diem.testing.miniwallet.client.RestClient.new_valid_kyc_data">new_valid_kyc_data</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.send" href="#diem.testing.miniwallet.client.RestClient.send">send</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.server_url" href="#diem.testing.miniwallet.client.RestClient.server_url">server_url</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.session" href="#diem.testing.miniwallet.client.RestClient.session">session</a></code></li>
<li><code><a title="diem.testing.miniwallet.client.RestClient.with_retry" href="#diem.testing.miniwallet.client.RestClient.with_retry">with_retry</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>